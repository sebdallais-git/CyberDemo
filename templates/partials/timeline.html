<!-- 7-step progress timeline — SSE-updated via Alpine.js -->
<div class="p-5 rounded-xl border border-gray-800 bg-gray-900/50 backdrop-blur-sm">
    <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-4">Incident Response Timeline</h3>

    <div class="space-y-3">
        <template x-for="(step, index) in stepDefs" :key="index">
            <div class="flex items-center gap-4 rounded-lg px-2 py-1 -mx-2 transition-all"
                 :class="{
                     'cursor-pointer hover:bg-blue-950/30 ring-1 ring-blue-500/50': paused && index === pauseStepIndex && pauseUrl,
                     'cursor-pointer hover:bg-emerald-950/30 ring-1 ring-emerald-500/50': paused && index === pauseStepIndex && !pauseUrl,
                 }"
                 @click="paused && index === pauseStepIndex && handlePauseAction()">
                <!-- Step indicator -->
                <div class="flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold transition-all duration-500"
                     :class="{
                         'bg-gray-800 text-gray-500': !steps[index] || steps[index].status === 'pending',
                         'bg-amber-500/20 text-amber-400 ring-2 ring-amber-500/50 animate-pulse': steps[index] && steps[index].status === 'running',
                         'bg-emerald-500/20 text-emerald-400 ring-2 ring-emerald-500/50': steps[index] && steps[index].status === 'complete' && !(paused && index === pauseStepIndex),
                         'bg-blue-500/20 text-blue-400 ring-2 ring-blue-500/50 animate-pulse': paused && index === pauseStepIndex && pauseUrl,
                         'bg-emerald-500/20 text-emerald-400 ring-2 ring-emerald-500/50 animate-pulse': paused && index === pauseStepIndex && !pauseUrl,
                         'bg-red-500/20 text-red-400 ring-2 ring-red-500/50': steps[index] && steps[index].status === 'error',
                     }">
                    <span x-text="index + 1"></span>
                </div>

                <!-- Step label -->
                <div class="flex-shrink-0 w-24">
                    <span class="text-xs font-bold uppercase"
                          :class="{
                              'text-gray-600': !steps[index] || steps[index].status === 'pending',
                              'text-amber-400': steps[index] && steps[index].status === 'running',
                              'text-emerald-400': steps[index] && steps[index].status === 'complete' && !(paused && index === pauseStepIndex),
                              'text-blue-400': paused && index === pauseStepIndex && pauseUrl,
                              'text-emerald-400': paused && index === pauseStepIndex && !pauseUrl,
                              'text-red-400': steps[index] && steps[index].status === 'error',
                          }"
                          x-text="step.name"></span>
                </div>

                <!-- Step message — shows action hint when paused -->
                <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-2">
                        <p class="text-xs truncate"
                           :class="{
                               'text-gray-600': !steps[index],
                               'text-gray-300': steps[index] && steps[index].status === 'running',
                               'text-gray-400': steps[index] && steps[index].status === 'complete' && !(paused && index === pauseStepIndex),
                               'text-blue-300 font-semibold': paused && index === pauseStepIndex && pauseUrl,
                               'text-emerald-300 font-semibold': paused && index === pauseStepIndex && !pauseUrl,
                           }"
                           x-text="paused && index === pauseStepIndex && pauseUrl
                               ? (pauseType === 'snowflake' ? '\u2190 Click to view Snowflake threat analysis' : '\u2190 Click to open ServiceNow incident')
                               : paused && index === pauseStepIndex && !pauseUrl
                                   ? '\u2190 Click to continue recovery workflow'
                                   : steps[index] ? steps[index].message : step.waiting"></p>
                        <!-- Databricks button — appears during AI Factory pause -->
                        <button x-show="paused && index === pauseStepIndex && databricksUrl"
                                x-cloak
                                @click.stop="openDatabricks()"
                                class="flex-shrink-0 px-2 py-0.5 text-[10px] font-bold uppercase rounded
                                       bg-orange-500/20 text-orange-400 ring-1 ring-orange-500/50
                                       hover:bg-orange-500/30 transition-colors">
                            View Databricks
                        </button>
                    </div>
                </div>

                <!-- Timestamp -->
                <div class="flex-shrink-0 text-xs text-gray-600"
                     x-show="steps[index] && steps[index].timestamp"
                     x-text="steps[index] ? formatTime(steps[index].timestamp) : ''">
                </div>
            </div>
        </template>
    </div>
</div>
