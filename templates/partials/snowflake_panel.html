<!-- Snowflake AI Threat Detection panel — appears after step 1 -->
<div class="p-5 rounded-xl border border-blue-900/50 bg-gray-900/50 backdrop-blur-sm">
    <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-2">
            <svg class="w-5 h-5 text-blue-400" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2L8.5 8.5 2 12l6.5 3.5L12 22l3.5-6.5L22 12l-6.5-3.5L12 2zm0 4.24L13.76 10 10 13.76 12 17.76 13.76 14 17.76 12 14 10.24 12 6.24z"/>
            </svg>
            <h3 class="text-sm font-semibold text-blue-400 uppercase tracking-wider">Snowflake AI Detection</h3>
        </div>
        <span class="text-xs px-2 py-0.5 rounded-full font-bold"
              :class="{
                  'bg-red-500/20 text-red-400': snowflakeDetection.threat_score > 8,
                  'bg-amber-500/20 text-amber-400': snowflakeDetection.threat_score > 5 && snowflakeDetection.threat_score <= 8,
                  'bg-blue-500/20 text-blue-400': snowflakeDetection.threat_score <= 5,
              }"
              x-text="snowflakeDetection.threat_score > 8 ? 'THREAT DETECTED' : snowflakeDetection.threat_score > 5 ? 'ANOMALY' : 'SCANNING'">
        </span>
    </div>

    <!-- Key metrics -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
        <div class="p-2 rounded-lg bg-gray-800/50 border border-gray-700 text-center">
            <div class="text-xl font-bold text-red-400" x-text="snowflakeDetection.threat_score + '/10'">—</div>
            <div class="text-[10px] text-gray-500 uppercase">Threat Score</div>
        </div>
        <div class="p-2 rounded-lg bg-gray-800/50 border border-gray-700 text-center">
            <div class="text-xl font-bold text-amber-400" x-text="snowflakeDetection.threat_count">—</div>
            <div class="text-[10px] text-gray-500 uppercase">Anomalous Hosts</div>
        </div>
        <div class="p-2 rounded-lg bg-gray-800/50 border border-gray-700 text-center">
            <div class="text-xl font-bold text-cyan-400" x-text="(snowflakeDetection.summary.total_network_events || 0).toLocaleString()">—</div>
            <div class="text-[10px] text-gray-500 uppercase">Network Events</div>
        </div>
        <div class="p-2 rounded-lg bg-gray-800/50 border border-gray-700 text-center">
            <div class="text-xl font-bold text-cyan-400" x-text="snowflakeDetection.summary.critical_detections || 0">—</div>
            <div class="text-[10px] text-gray-500 uppercase">Critical Alerts</div>
        </div>
    </div>

    <!-- Threat details table -->
    <div x-show="snowflakeDetection.threats && snowflakeDetection.threats.length > 0">
        <h4 class="text-xs font-semibold text-gray-400 uppercase mb-2">Anomalous Hosts (ML Model: sf-anomaly-v3.2)</h4>
        <div class="space-y-1">
            <template x-for="threat in snowflakeDetection.threats" :key="threat.hostname">
                <div class="flex items-center justify-between text-xs p-2 rounded bg-gray-800/50">
                    <span class="font-mono font-bold w-28"
                          :class="threat.threat_score > 8 ? 'text-red-400' : 'text-amber-400'"
                          x-text="threat.hostname"></span>
                    <span class="text-gray-500 w-24" x-text="threat.ip"></span>
                    <div class="flex-1 mx-3">
                        <!-- Score bar -->
                        <div class="w-full h-1.5 bg-gray-700 rounded-full overflow-hidden">
                            <div class="h-full rounded-full transition-all"
                                 :class="threat.threat_score > 8 ? 'bg-red-500' : 'bg-amber-500'"
                                 :style="'width: ' + (threat.threat_score * 10) + '%'"></div>
                        </div>
                    </div>
                    <span class="font-bold w-12 text-right"
                          :class="threat.threat_score > 8 ? 'text-red-400' : 'text-amber-400'"
                          x-text="threat.threat_score + '/10'"></span>
                    <span class="text-[10px] font-bold uppercase w-20 text-right"
                          :class="{
                              'text-red-400': threat.anomaly_label === 'CRITICAL_ANOMALY',
                              'text-amber-400': threat.anomaly_label === 'HIGH_ANOMALY',
                          }"
                          x-text="threat.anomaly_label.replace('_', ' ')"></span>
                </div>
            </template>
        </div>
    </div>

    <!-- Query source -->
    <div class="mt-3 pt-3 border-t border-gray-800 flex items-center justify-between text-[10px] text-gray-600">
        <span>Source: Snowflake CYBER_SECURITY.SIEM</span>
        <span x-text="'Model: ' + (snowflakeDetection.model_version || '—')"></span>
    </div>
</div>
