{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<div x-data="cyberDemo()" x-init="checkStatus()">

    <!-- Nav bar -->
    <div class="flex items-center gap-3 mb-6">
        <a href="/infrastructure"
           class="inline-flex items-center gap-2 px-4 py-2 text-xs font-semibold text-gray-400 border border-gray-800 rounded-lg bg-gray-900/50 hover:bg-gray-800/50 hover:border-gray-600 hover:text-gray-200 transition-all">
            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round">
                <rect x="2" y="3" width="8" height="6" rx="1"/><rect x="14" y="3" width="8" height="6" rx="1"/>
                <rect x="2" y="15" width="8" height="6" rx="1"/><rect x="14" y="15" width="8" height="6" rx="1"/>
                <line x1="6" y1="9" x2="6" y2="15"/><line x1="18" y1="9" x2="18" y2="15"/>
                <line x1="10" y1="6" x2="14" y2="6"/><line x1="10" y1="18" x2="14" y2="18"/>
            </svg>
            IT/OT Infrastructure
        </a>
        <a href="/infrastructure/ai"
           class="inline-flex items-center gap-2 px-4 py-2 text-xs font-semibold text-purple-400/70 border border-purple-900/30 rounded-lg bg-gray-900/50 hover:bg-purple-950/30 hover:border-purple-500/40 hover:text-purple-300 transition-all">
            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round">
                <rect x="4" y="4" width="16" height="16" rx="2"/>
                <path d="M9 9h6v6H9z"/><circle cx="9" cy="9" r="1"/><circle cx="15" cy="9" r="1"/>
                <circle cx="9" cy="15" r="1"/><circle cx="15" cy="15" r="1"/>
            </svg>
            AI Factory Map
        </a>
        <a href="/snowflake"
           class="inline-flex items-center gap-2 px-4 py-2 text-xs font-semibold text-blue-400/70 border border-blue-900/30 rounded-lg bg-gray-900/50 hover:bg-blue-950/30 hover:border-blue-500/40 hover:text-blue-300 transition-all">
            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2L8.5 8.5 2 12l6.5 3.5L12 22l3.5-6.5L22 12l-6.5-3.5L12 2zm0 4.24L13.76 10 10 13.76 12 17.76 13.76 14 17.76 12 14 10.24 12 6.24z"/>
            </svg>
            Snowflake SIEM
        </a>
        <a href="/infrastructure?state=attacked"
           class="inline-flex items-center gap-2 px-4 py-2 text-xs font-semibold text-red-400/70 border border-red-900/30 rounded-lg bg-gray-900/50 hover:bg-red-950/30 hover:border-red-500/40 hover:text-red-300 transition-all">
            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round">
                <path d="M12 9v4m0 4h.01M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
            </svg>
            Attack View
        </a>
        <a href="/agents"
           class="inline-flex items-center gap-2 px-4 py-2 text-xs font-semibold text-emerald-400/70 border border-emerald-900/30 rounded-lg bg-gray-900/50 hover:bg-emerald-950/30 hover:border-emerald-500/40 hover:text-emerald-300 transition-all">
            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round">
                <path d="M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 014.5 0m0 0v5.714a2.25 2.25 0 00.659 1.591L19 14.5M14.25 3.104c.251.023.501.05.75.082M19 14.5l-2.47 2.47a2.25 2.25 0 01-1.591.659H9.061a2.25 2.25 0 01-1.591-.659L5 14.5m14 0V17a2 2 0 01-2 2H7a2 2 0 01-2-2v-2.5"/>
            </svg>
            AI Agents
        </a>
        <button @click="toggleDirector()"
                class="inline-flex items-center gap-2 px-4 py-2 text-xs font-semibold border rounded-lg bg-gray-900/50 transition-all"
                :class="directorEnabled
                    ? 'text-amber-300 border-amber-500/50 bg-amber-950/30'
                    : 'text-gray-400 border-gray-800 hover:bg-gray-800/50 hover:border-gray-600 hover:text-gray-200'">
            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round">
                <path d="M3.75 3v11.25A2.25 2.25 0 006 16.5h2.25M3.75 3h-1.5m1.5 0h16.5m0 0h1.5m-1.5 0v11.25A2.25 2.25 0 0118 16.5h-2.25m-7.5 0h7.5m-7.5 0l-1 3m8.5-3l1 3m0 0l.5 1.5m-.5-1.5h-9.5m0 0l-.5 1.5"/>
            </svg>
            <span x-text="directorEnabled ? 'Director ON' : 'Director'"></span>
        </button>
    </div>

    <!-- Scenario Buttons -->
    <section class="mb-8">
        <h2 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-4">Launch Scenario</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <!-- Ransomware -->
            <button @click="startScenario('ransomware')" :disabled="running"
                class="group relative p-5 rounded-xl border border-red-900/50 bg-gray-900/50 hover:bg-red-950/30 hover:border-red-500/50 transition-all text-left disabled:opacity-50 disabled:cursor-not-allowed">
                <div class="text-red-400 font-bold text-sm mb-1">Ransomware Attack</div>
                <div class="text-gray-400 text-xs">LockBit 4.0 on SCADA historian servers. Production line B3 halted.</div>
                <div class="absolute top-3 right-3 w-3 h-3 rounded-full bg-red-500/50 group-hover:bg-red-500 transition-all"></div>
            </button>
            <!-- AI Factory -->
            <button @click="startScenario('ai_factory')" :disabled="running"
                class="group relative p-5 rounded-xl border border-purple-900/50 bg-gray-900/50 hover:bg-purple-950/30 hover:border-purple-500/50 transition-all text-left disabled:opacity-50 disabled:cursor-not-allowed">
                <div class="text-purple-400 font-bold text-sm mb-1">AI Factory Compromise</div>
                <div class="text-gray-400 text-xs">APT targets drug discovery pipeline. Databricks + Dell AI Factory. Phase III at risk.</div>
                <div class="absolute top-3 right-3 w-3 h-3 rounded-full bg-purple-500/50 group-hover:bg-purple-500 transition-all"></div>
            </button>
            <!-- Data Exfil -->
            <button @click="startScenario('data_exfil')" :disabled="running"
                class="group relative p-5 rounded-xl border border-cyan-900/50 bg-gray-900/50 hover:bg-cyan-950/30 hover:border-cyan-500/50 transition-all text-left disabled:opacity-50 disabled:cursor-not-allowed">
                <div class="text-cyan-400 font-bold text-sm mb-1">Data Exfiltration</div>
                <div class="text-gray-400 text-xs">DNS tunneling exfil of GxP data. 4.2 GB over 72 hours.</div>
                <div class="absolute top-3 right-3 w-3 h-3 rounded-full bg-cyan-500/50 group-hover:bg-cyan-500 transition-all"></div>
            </button>
        </div>
    </section>

    <!-- Attack Events Feed (cascades during DETECT phase) -->
    <section x-show="attackEvents.length > 0" x-transition class="mb-8">
        {% include "partials/attack_feed.html" %}
    </section>

    <!-- Live Timeline -->
    <section class="mb-8">
        {% include "partials/timeline.html" %}
    </section>


    <!-- AI Factory Impact Panel (only visible for ai_factory scenario) -->
    <section x-show="scenarioType === 'ai_factory'" x-transition class="mb-8">
        {% include "partials/ai_impact_panel.html" %}
    </section>

    <!-- Snowflake Detection Panel (appears after step 1 completes with Snowflake data) -->
    <section x-show="snowflakeDetection.threats && snowflakeDetection.threats.length > 0" x-transition class="mb-8">
        {% include "partials/snowflake_panel.html" %}
    </section>

    <!-- Two-column panels -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        <!-- ServiceNow Incident Card -->
        <div>
            {% include "partials/snow_card.html" %}
        </div>
        <!-- Dell CR Vault Panel -->
        <div>
            {% include "partials/vault_panel.html" %}
        </div>
    </div>

    <!-- CyberSense Report (appears after step 5) -->
    <section x-show="steps[4] && steps[4].status === 'complete'" x-transition class="mb-8">
        {% include "partials/cybersense_report.html" %}
    </section>

    <!-- Recovery Progress (appears during step 6) -->
    <section x-show="currentStep >= 6" x-transition class="mb-8">
        {% include "partials/recovery_bar.html" %}
    </section>

    <!-- Director Panel (collapsible side panel for presenter cues) -->
    {% include "partials/director_panel.html" %}

</div>
{% endblock %}
